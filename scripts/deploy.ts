import { ethers, network, upgrades } from "hardhat";
import fs from "fs";
import hre from "hardhat";
import { SwapManager, AffiliateRouter } from "../typechain-types";
import { executeTx, generateSwapRoute, replaceTx, verifyProxyImplementation, waitFor } from "./util";
import { responseData } from "./data";

async function main() {
  console.log("Starting deployments");
  const accounts = await hre.ethers.getSigners();
  const deployer = accounts[0];
  const SwapManagerAddress = "0x614Cc6667bD97367E01940eD6939cEA612a0c391";
  const AffiliateRouterAddress = "0x484f957900F15919f9d3D48e70703d66f34A22DE";
  const PhuxVaultAddress = "0x7F51AC3df6A034273FB09BB29e383FCF655e473c";
  const PulseXV1RouterAddress = "0x98bf93ebf5c380C0e6Ae8e192A7e2AE08edAcc02";
  const PulseXV2RouterAddress = "0x165C3410fC91EF562C50559f7d2289fEbed552d9";
  const nineInchV2RouterAddress = "0xeB45a3c4aedd0F47F345fB4c8A1802BB5740d725";
  const nineInchV3RouterAddress = "0x42556A17EF0Bd815bF21aD628DFd2e2f3b5F9ac7";
  const nineMMRouterAddress = "0xa9444246d80d6e3496c9242395213b4f22226a59"
  const dexTopRouterAddress = "0x1f849694Ef24a2245bCa415FE47500216B24d7FF"
  const pDexV3RouterAddress = "0x1eC2eaA62117486c9b2a05F098a7bF2568e19204"
  const TideVaultAddress = "0x634F6B9Cd1f860314871548d2224362825384B2D"

  // const nonce = await deployer.getNonce();
  // console.log("Nonce:", nonce);
  // await replaceTx(deployer, nonce);
  // return;
  console.log("Deployer address:", deployer.address);

  const SwapManagerFactory = await ethers.getContractFactory("SwapManager");
  // const SwapManager = await upgrades.deployProxy(SwapManagerFactory, [])
  // await SwapManager.waitForDeployment()
  // const SwapManager = await upgrades.upgradeProxy(SwapManagerAddress, SwapManagerFactory);
  // await SwapManager.waitForDeployment();
  const SwapManager = SwapManagerFactory.attach(SwapManagerAddress) as SwapManager;
  console.log("SwapManager deployed to:", await SwapManager.getAddress());

  const AffiliateRouterFactory = await ethers.getContractFactory("AffiliateRouter");
  // const AffiliateRouter = await upgrades.deployProxy(AffiliateRouterFactory, [await SwapManager.getAddress()]) as AffiliateRouter;
  // await AffiliateRouter.waitForDeployment()
  // const AffiliateRouter = await upgrades.upgradeProxy(AffiliateRouterAddress, AffiliateRouterFactory);
  // await AffiliateRouter.waitForDeployment();
  const AffiliateRouter = AffiliateRouterFactory.attach(AffiliateRouterAddress) as AffiliateRouter;
  console.log("AffiliateRouter deployed to:", await AffiliateRouter.getAddress());

  // await SwapManager.connect(deployer).setAffiliateRouter(await AffiliateRouter.getAddress());
  // console.log("AffiliateRouter set")

  // await waitFor(5);
  // await executeTx(
  //   SwapManager.connect(deployer).setDexRouters(
  //     ["pulsexV1", "pulsexV2", "9inchV2", "9inchV3", "phux", "9mmV3", "9mmV2", "pulsexStable", "dexTop", "pDexV3", "tide"],
  //     [
  //       PulseXV1RouterAddress,
  //       PulseXV2RouterAddress,
  //       nineInchV2RouterAddress,
  //       nineInchV3RouterAddress,
  //       PhuxVaultAddress,
  //       nineMMRouterAddress,
  //       nineMMRouterAddress,
  //       '0x0000000000000000000000000000000000000001',
  //       dexTopRouterAddress,
  //       pDexV3RouterAddress,
  //       TideVaultAddress
  //     ]
  // ));
  // console.log('DexRouters set')

  // const phiatAddress = "0x96E035ae0905EFaC8F733f133462f971Cfa45dB1"
  // const swapRoute: SwapManager.SwapRouteStruct = {
  // 	steps: [{
  // 		dex: 'phux',
  // 		path: [ethers.ZeroAddress, phiatAddress],
  // 		amountIn: ethers.parseEther('1000'),
  // 		amountOutMin: ethers.parseEther('0'),
  // 		pool: "0xD444b7A1d07727a042b61B83Ff3D99e93048F2f4",
  // 		userData: ethers.zeroPadBytes(ethers.toUtf8Bytes('0x'), 32)
  // 	}],
  // 	deadline: Math.floor(Date.now() / 1000 + 1000 * 10).toString()
  // };

	// await waitFor(3);
	// const swapRoute: string = await generateSwapRoute()

  // const swapRoute = "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000bc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a1077a294dde1b09bb078844df40758a5d0f9a270000000000000000000000000cb6f5a34ad42ec934882a05265a7d5f59b51a2f00000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000068b6a9a800000000000000000000000000000000000000000000003635c9adc5dea00000000000000000000000000000000000000000000000000000000000000000a44b000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000005a0000000000000000000000000000000000000000000000000000000000000074000000000000000000000000000000000000000000000000000000000000008e000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001200000000000000000000000005f473a70e89778d5c600f2c0e692a86c26792a2500000000000000000000000000000000000000000000000000000000000186a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000470687578000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000a1077a294dde1b09bb078844df40758a5d0f9a270000000000000000000000009663c2d75ffd5f4017310405fce61720af45b829000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000cddaede234bf06082198b38567c05c40df5b6b3100000000000000000000000000000000000000000000000000000000000186a00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000004706875780000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000009663c2d75ffd5f4017310405fce61720af45b82900000000000000000000000095b303987a60c71504d99aa1b13b4da07b0790ab000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001200000000000000000000000008e52f6c89becf3b3732a89f7d995979f0260371f00000000000000000000000000000000000000000000000000000000000186a0000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000870756c7365785631000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000095b303987a60c71504d99aa1b13b4da07b0790ab0000000000000000000000000cb6f5a34ad42ec934882a05265a7d5f59b51a2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000f39b2485e34f282fb3d2db6b0f1dbfb78b2adda600000000000000000000000000000000000000000000000000000000000186a0000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000474696465000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000a1077a294dde1b09bb078844df40758a5d0f9a270000000000000000000000002a06a971fe6ffa002fd242d437e3db2b5cc5b433000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001200000000000000000000000001bb0b07ee7e95f2b8bbf115385311dc63638abcf00000000000000000000000000000000000000000000000000000000000186a00000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000004706875780000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000002a06a971fe6ffa002fd242d437e3db2b5cc5b433000000000000000000000000efd766ccb38eaf1dfd701853bfce31359239f305000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000b272ae05c5f5ece5a3a599928c06469ebc73fc3100000000000000000000000000000000000000000000000000000000000186a0000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000470687578000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000efd766ccb38eaf1dfd701853bfce31359239f3050000000000000000000000000cb6f5a34ad42ec934882a05265a7d5f59b51a2f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c3500000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000c34f"
  // const referrer = ethers.ZeroAddress;
  // await executeTx(AffiliateRouter.connect(deployer).executeSwap(swapRoute, referrer, { value: ethers.parseEther('1000') }));
  // console.log('Swap executed')

  // await waitFor(8);
  // await verifyProxyImplementation(await SwapManager.getAddress());
}

// We recommend this pattern to be able to use async/await everywhere
// and properly handle errors.
main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
